<!DOCTYPE HTML>
<html lang="en-US">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>IDT and interrupts | How to Make a Computer Operating System in C++</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="SamyPesse">
        <meta name="description" content="Online book about how to write a computer operating system in C/C++ from scratch">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        <meta property="og:title" content="IDT and interrupts | How to Make a Computer Operating System in C++">
        <meta property="og:site_name" content="How to Make a Computer Operating System in C++">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/SamyPesse">
        <meta property="book:tag" content="GitBook">
        
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        <link rel="stylesheet" href="../gitbook/style.css">

        <script type="text/javascript">
        (function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");
        for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=e.createElement("script");a.type="text/javascript";a.src=("https:"===e.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f)}})(document,window.mixpanel||[]);
        mixpanel.init("01eb2b950ae09a5fdb15a98dcc5ff20e");
        </script>
        
    </head>
    <body>
        
<div class="book " data-github="SamyPesse/How-to-Make-a-Computer-Operating-System" data-level="7">
    <div class="book-header">
    <!-- Actions Left -->
    <a href="https://github.com/SamyPesse/How-to-Make-a-Computer-Operating-System" target="_blank" class="btn pull-left"><i class="fa fa-github-alt"></i></a>
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>

    <!-- Actions Right -->
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>

    <a href="https://github.com/SamyPesse/How-to-Make-a-Computer-Operating-System/stargazers" target="_blank" class="btn pull-right count-star"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/SamyPesse/How-to-Make-a-Computer-Operating-System/watchers" target="_blank" class="btn pull-right count-watch"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>


    <!-- Title -->
    <h1><a href="../README.html" >How to Make a Computer Operating System in C++</a></h1>
</div>
    <div class="book-summary">
    <ul class="summary">
        <li>
            <a href="https://github.com/SamyPesse" target="blank">About the author</a>
        </li>
        <li>
            <a href="https://github.com/SamyPesse/How-to-Make-a-Computer-Operating-System/issues" target="blank">Questions and Issues</a>
        </li>
        <li>
            <a href="https://github.com/SamyPesse/How-to-Make-a-Computer-Operating-System/edit/master/Chapter-7/README.md" target="blank">Edit and Contribute</a>
        </li>
        <li class="divider"></li>
        <li data-level="0">
            <a href="../README.html"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1">
                
                <a href="../Chapter-1/README.html">
                    <i class="fa fa-check"></i> <b>1)</b> Introduction about the x86 architecture and about our OS
                </a>
                
                
            </li>
        
            <li  data-level="2">
                
                <a href="../Chapter-2/README.html">
                    <i class="fa fa-check"></i> <b>2)</b> Setup the development environment
                </a>
                
                
            </li>
        
            <li  data-level="3">
                
                <a href="../Chapter-3/README.html">
                    <i class="fa fa-check"></i> <b>3)</b> First boot with GRUB
                </a>
                
                
            </li>
        
            <li  data-level="4">
                
                <a href="../Chapter-4/README.html">
                    <i class="fa fa-check"></i> <b>4)</b> Backbone of the OS and C++ runtime
                </a>
                
                
            </li>
        
            <li  data-level="5">
                
                <a href="../Chapter-5/README.html">
                    <i class="fa fa-check"></i> <b>5)</b> Base classes for managing x86 architecture
                </a>
                
                
            </li>
        
            <li  data-level="6">
                
                <a href="../Chapter-6/README.html">
                    <i class="fa fa-check"></i> <b>6)</b> GDT
                </a>
                
                
            </li>
        
            <li class="active" data-level="7">
                
                <a href="../Chapter-7/README.html">
                    <i class="fa fa-check"></i> <b>7)</b> IDT and interrupts
                </a>
                
                
            </li>
        
            <li  data-level="8">
                
                <a href="../Chapter-8/README.html">
                    <i class="fa fa-check"></i> <b>8)</b> Memory management: physical and virtual
                </a>
                
                
            </li>
        
            <li  data-level="9">
                
                <span><b>9)</b> Process management and multitasking</span>
                
                
            </li>
        
            <li  data-level="10">
                
                <span><b>10)</b> External program execution: ELF files</span>
                
                
            </li>
        
            <li  data-level="11">
                
                <span><b>11)</b> Userland and syscalls</span>
                
                
            </li>
        
            <li  data-level="12">
                
                <span><b>12)</b> Modular drivers</span>
                
                
            </li>
        
            <li  data-level="13">
                
                <span><b>13)</b> Some basics modules: console, keyboard</span>
                
                
            </li>
        
            <li  data-level="14">
                
                <span><b>14)</b> IDE Hard disks</span>
                
                
            </li>
        
            <li  data-level="15">
                
                <span><b>15)</b> DOS Partitions</span>
                
                
            </li>
        
            <li  data-level="16">
                
                <span><b>16)</b> EXT2 read-only filesystems</span>
                
                
            </li>
        
            <li  data-level="17">
                
                <span><b>17)</b> Standard C library (libC)</span>
                
                
            </li>
        
            <li  data-level="18">
                
                <span><b>18)</b> UNIX basic tools: sh, cat</span>
                
                
            </li>
        
            <li  data-level="19">
                
                <span><b>19)</b> Lua interpreter</span>
                
                
            </li>
        
    </ul>
</div>
    <div class="book-body">
        <div class="page-wrapper">
            <div class="book-progress">
                <div class="bar">
                    <div class="inner" style="width: 87.5%;min-width: 75%;"></div>
                </div>
                <div class="chapters">
                
                    <a href="../README.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
                
                    <a href="../Chapter-1/README.html" title="Introduction about the x86 architecture and about our OS" class="chapter done new-chapter" data-progress="1" style="left: 12.5%;"></a>
                
                    <a href="../Chapter-2/README.html" title="Setup the development environment" class="chapter done new-chapter" data-progress="2" style="left: 25%;"></a>
                
                    <a href="../Chapter-3/README.html" title="First boot with GRUB" class="chapter done new-chapter" data-progress="3" style="left: 37.5%;"></a>
                
                    <a href="../Chapter-4/README.html" title="Backbone of the OS and C++ runtime" class="chapter done new-chapter" data-progress="4" style="left: 50%;"></a>
                
                    <a href="../Chapter-5/README.html" title="Base classes for managing x86 architecture" class="chapter done new-chapter" data-progress="5" style="left: 62.5%;"></a>
                
                    <a href="../Chapter-6/README.html" title="GDT" class="chapter done new-chapter" data-progress="6" style="left: 75%;"></a>
                
                    <a href="../Chapter-7/README.html" title="IDT and interrupts" class="chapter done new-chapter" data-progress="7" style="left: 87.5%;"></a>
                
                    <a href="../Chapter-8/README.html" title="Memory management: physical and virtual" class="chapter  new-chapter" data-progress="8" style="left: 100%;"></a>
                
                </div>
            </div>

            <div class="page-inner">
            
                <section class="normal" id="section-gitbook_1">
                
                    <h2 id="chapter-7-idt-and-interrupts">Chapter 7: IDT and interrupts</h2>
<p>An interrupt is a signal to the processor emitted by hardware or software indicating an event that needs immediate attention.</p>
<p>There are 3 types of interrupts:</p>
<ul>
<li><strong>Hardware interrupts:</strong> are sent to the processor from an external device (keyboard, mouse, hard disk, ...). Hardware interrupts were introduced as a way to reduce wasting the processor&#39;s valuable time in polling loops, waiting for external events.</li>
<li><strong>Software interrupts:</strong> are initiated voluntarily by the software. It&#39;s used to manage system calls.</li>
<li><strong>Exceptions:</strong>  are used for errors or events occurring during program execution that are exceptional enough that they cannot be handled within the program itself (division by zero, page fault, ...)</li>
</ul>
<h4 id="the-keyboard-example-">The keyboard example:</h4>
<p>When the user pressed a key on the keyboard, the keyboard controller will signal an interrupt to the Interrupt Controller. If the interrupt is not masked, the controller signal the interrupt to the processor, the processor will execute a routine to manage the interrupt (key pressed or key released), this routine could for example get the pressed key from the keyboard controller and print the key to the screen. Once the character processing routine is completed, the interrupted job can be resumed.</p>
<h4 id="what-is-the-pic-">What is the PIC?</h4>
<p>The <a href="http://en.wikipedia.org/wiki/Programmable_Interrupt_Controller" target="_blank">PIC</a> (Programmable interrupt controller)is a device that is used to combine several sources of interrupt onto one or more CPU lines, while allowing priority levels to be assigned to its interrupt outputs. When the device has multiple interrupt outputs to assert, it asserts them in the order of their relative priority.</p>
<p>The best known PIC is the 8259A, each 8259A can handle 8 devices but most computers have two controllers: one master and one slave, it&#39;s allow the computer to manager interrupts from 14 devices.</p>
<p>In this chapter, we will need to program this controller to initialize it and mask interrupts.</p>
<h4 id="what-is-the-idt-">What is the IDT?</h4>
<blockquote>
<p>The Interrupt Descriptor Table (IDT) is a data structure used by the x86 architecture to implement an interrupt vector table. The IDT is used by the processor to determine the correct response to interrupts and exceptions.</p>
</blockquote>
<p>Our kernel is going to use the IDT to define the different functions to be executed when an interrupt occurred.</p>
<p>Like the GDT, the IDT is loaded using the LIDTL assembly instruction. It expects the location of a IDT description structure:</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">struct</span> idtr {
    u16 limite;
    u32 base;
} __attribute__ ((packed));
</code></pre>
<p>The IDT table is composed of IDT segments with the following structure:</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">struct</span> idtdesc {
    u16 offset0_15;
    u16 select;
    u16 type;
    u16 offset16_31;
} __attribute__ ((packed));
</code></pre>
<p><strong>Caution:</strong> the directive <code>__attribute__ ((packed))</code> signal to gcc that the structure should use as little memory as possible. Without this directive, gcc include some bytes to optimize the memory alignment and the access during execution.</p>
<p>Now we need to define our IDT table and then load it using LIDTL. The IDT table can be stored wherever we want in memory, its address should just be signaled to the process using the IDTR registry.</p>
<p>Here is a table of common interrupts (Maskable hardware interrupt are called IRQ):</p>
<table>
<thead>
<tr>
<th style="text-align:center">IRQ</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td>Programmable Interrupt Timer Interrupt</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td>Keyboard Interrupt</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td>Cascade (used internally by the two PICs. never raised)</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td>COM2 (if enabled)</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td>COM1 (if enabled)</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td>LPT2 (if enabled)</td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td>Floppy Disk</td>
</tr>
<tr>
<td style="text-align:center">7</td>
<td>LPT1</td>
</tr>
<tr>
<td style="text-align:center">8</td>
<td>CMOS real-time clock (if enabled)</td>
</tr>
<tr>
<td style="text-align:center">9</td>
<td>Free for peripherals / legacy SCSI / NIC</td>
</tr>
<tr>
<td style="text-align:center">10</td>
<td>Free for peripherals / SCSI / NIC</td>
</tr>
<tr>
<td style="text-align:center">11</td>
<td>Free for peripherals / SCSI / NIC</td>
</tr>
<tr>
<td style="text-align:center">12</td>
<td>PS2 Mouse</td>
</tr>
<tr>
<td style="text-align:center">13</td>
<td>FPU / Coprocessor / Inter-processor</td>
</tr>
<tr>
<td style="text-align:center">14</td>
<td>Primary ATA Hard Disk</td>
</tr>
<tr>
<td style="text-align:center">15</td>
<td>Secondary ATA Hard Disk</td>
</tr>
</tbody>
</table>
<h4 id="how-to-initialize-the-interrupts-">How to initialize the interrupts?</h4>
<p>This is a simple method to define an IDT segment</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">void</span> init_idt_desc(u16 select, u32 offset, u16 type, <span class="hljs-keyword">struct</span> idtdesc *desc)
{
    desc-&gt;offset0_15 = (offset &amp; <span class="hljs-number">0xffff</span>);
    desc-&gt;select = select;
    desc-&gt;type = type;
    desc-&gt;offset16_31 = (offset &amp; <span class="hljs-number">0xffff0000</span>) &gt;&gt; <span class="hljs-number">16</span>;
    <span class="hljs-keyword">return</span>;
}
</code></pre>
<p>And we can now initialize the interupts:</p>
<pre><code class="lang-cpp"><span class="hljs-preprocessor">#define IDTBASE    0x00000000</span>
<span class="hljs-preprocessor">#define IDTSIZE 0xFF</span>
idtr kidtr;
</code></pre>
<pre><code class="lang-cpp"><span class="hljs-keyword">void</span> init_idt(<span class="hljs-keyword">void</span>)
{
    <span class="hljs-comment">/* Init irq */</span>
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; IDTSIZE; i++) 
        init_idt_desc(<span class="hljs-number">0x08</span>, (u32)_asm_schedule, INTGATE, &amp;kidt[i]); <span class="hljs-comment">// </span>

    <span class="hljs-comment">/* Vectors  0 -&gt; 31 are for exceptions */</span>
    init_idt_desc(<span class="hljs-number">0x08</span>, (u32) _asm_exc_GP, INTGATE, &amp;kidt[<span class="hljs-number">13</span>]);        <span class="hljs-comment">/* #GP */</span>
    init_idt_desc(<span class="hljs-number">0x08</span>, (u32) _asm_exc_PF, INTGATE, &amp;kidt[<span class="hljs-number">14</span>]);     <span class="hljs-comment">/* #PF */</span>

    init_idt_desc(<span class="hljs-number">0x08</span>, (u32) _asm_schedule, INTGATE, &amp;kidt[<span class="hljs-number">32</span>]);
    init_idt_desc(<span class="hljs-number">0x08</span>, (u32) _asm_int_1, INTGATE, &amp;kidt[<span class="hljs-number">33</span>]);

    init_idt_desc(<span class="hljs-number">0x08</span>, (u32) _asm_syscalls, TRAPGATE, &amp;kidt[<span class="hljs-number">48</span>]);
    init_idt_desc(<span class="hljs-number">0x08</span>, (u32) _asm_syscalls, TRAPGATE, &amp;kidt[<span class="hljs-number">128</span>]); <span class="hljs-comment">//48</span>

    kidtr.limite = IDTSIZE * <span class="hljs-number">8</span>;
    kidtr.base = IDTBASE;


    <span class="hljs-comment">/* Copy the IDT to the memory */</span>
    <span class="hljs-built_in">memcpy</span>((<span class="hljs-keyword">char</span> *) kidtr.base, (<span class="hljs-keyword">char</span> *) kidt, kidtr.limite);

    <span class="hljs-comment">/* Load the IDTR registry */</span>
    <span class="hljs-keyword">asm</span>(<span class="hljs-string">"lidtl (kidtr)"</span>);
}
</code></pre>
<p>After intialization our IDT, we need to activate interrupts by configuring the PIC. The following function will configure the two PICs by writting in their internal registries using the output ports of the processor <code>io.outb</code>. We configure the PICs using the ports:</p>
<ul>
<li>Master PIC: 0x20 and 0x21</li>
<li>Slave PIC: 0xA0 and 0xA1</li>
</ul>
<p>For a PIC, there is 2 types of registries:</p>
<ul>
<li>ICW (Initialization Command Word): reinit the controller</li>
<li>OCW (Operation Control Word): configure the controller once initialized (used to mask/unmask the interrupts)</li>
</ul>
<pre><code class="lang-cpp"><span class="hljs-keyword">void</span> init_pic(<span class="hljs-keyword">void</span>)
{
    <span class="hljs-comment">/* Initialization of ICW1 */</span>
    io.outb(<span class="hljs-number">0x20</span>, <span class="hljs-number">0x11</span>);
    io.outb(<span class="hljs-number">0xA0</span>, <span class="hljs-number">0x11</span>);

    <span class="hljs-comment">/* Initialization of ICW2 */</span>
    io.outb(<span class="hljs-number">0x21</span>, <span class="hljs-number">0x20</span>);    <span class="hljs-comment">/* start vector = 32 */</span>
    io.outb(<span class="hljs-number">0xA1</span>, <span class="hljs-number">0x70</span>);    <span class="hljs-comment">/* start vector = 96 */</span>

    <span class="hljs-comment">/* Initialization of ICW3 */</span>
    io.outb(<span class="hljs-number">0x21</span>, <span class="hljs-number">0x04</span>);
    io.outb(<span class="hljs-number">0xA1</span>, <span class="hljs-number">0x02</span>);

    <span class="hljs-comment">/* Initialization of ICW4 */</span>
    io.outb(<span class="hljs-number">0x21</span>, <span class="hljs-number">0x01</span>);
    io.outb(<span class="hljs-number">0xA1</span>, <span class="hljs-number">0x01</span>);

    <span class="hljs-comment">/* mask interrupts */</span>
    io.outb(<span class="hljs-number">0x21</span>, <span class="hljs-number">0x0</span>);
    io.outb(<span class="hljs-number">0xA1</span>, <span class="hljs-number">0x0</span>);
}
</code></pre>
<h4 id="pic-icw-configurations-details">PIC ICW configurations details</h4>
<p>The registries have to be configured in order.</p>
<p><strong>ICW1 (port 0x20 / port 0xA0)</strong></p>
<pre><code>|<span class="hljs-number">0</span>|<span class="hljs-number">0</span>|<span class="hljs-number">0</span>|<span class="hljs-number">1</span>|x|<span class="hljs-number">0</span>|x|x|
         |   | +--- <span class="hljs-keyword">with</span> ICW4 (<span class="hljs-number">1</span>) <span class="hljs-keyword">or</span> without (<span class="hljs-number">0</span>)
         |   +----- one controller (<span class="hljs-number">1</span>), <span class="hljs-keyword">or</span> cascade (<span class="hljs-number">0</span>)
         +--------- triggering <span class="hljs-keyword">by</span> level (level) (<span class="hljs-number">1</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">by</span> edge (edge) (<span class="hljs-number">0</span>)
</code></pre><p><strong>ICW2 (port 0x21 / port 0xA1)</strong></p>
<pre><code><span class="hljs-localvars">|x|x|x|x|x|</span><span class="hljs-number">0</span>|<span class="hljs-number">0</span>|<span class="hljs-number">0</span>|  
 | | | | |
 +----------------- base address for interrupts vectors
</code></pre><p><strong>ICW2 (port 0x21 / port 0xA1)</strong></p>
<p>For the master:</p>
<pre><code><span class="hljs-localvars">|x|x|x|x|x|x|x|x|</span>
 | | | | | | | |
 +------------------ slave controller connected to the port yes (<span class="hljs-number">1</span>), or no (<span class="hljs-number">0</span>)
</code></pre><p>For the slave:</p>
<pre><code>|<span class="hljs-number">0</span>|<span class="hljs-number">0</span>|<span class="hljs-number">0</span>|<span class="hljs-number">0</span>|<span class="hljs-number">0</span>|x|x|x|  pour l<span class="hljs-comment">'esclave</span>
           | | |
           +-------- Slave ID which <span class="hljs-keyword">is</span> equal <span class="hljs-keyword">to</span> the master port
</code></pre><p><strong>ICW4 (port 0x21 / port 0xA1)</strong></p>
<p>It is used to define in which mode the controller chould works.</p>
<pre><code>|<span class="hljs-number">0</span>|<span class="hljs-number">0</span>|<span class="hljs-number">0</span><span class="hljs-localvars">|x|x|x|x|</span><span class="hljs-number">1</span>|
       | | | +------ mode <span class="hljs-comment">"automatic end of interrupt"</span> <span class="hljs-class">AEOI</span> (<span class="hljs-number">1</span>)
       | | +-------- mode buffered slave (<span class="hljs-number">0</span>) or master (<span class="hljs-number">1</span>)
       | +---------- mode buffered (<span class="hljs-number">1</span>)
       +------------ mode <span class="hljs-comment">"fully nested"</span> (<span class="hljs-number">1</span>)
</code></pre><h4 id="why-does-idt-segments-offset-are-asm-functions-">Why does idt segments offset are ASM functions?</h4>
<p>You should had notice that when I&#39;m initializing our IDT segments, I&#39;m using offset to segment of code in Assembly. The se different functions are defined in <a href="https://github.com/SamyPesse/How-to-Make-a-Computer-Operating-System/blob/master/src/kernel/arch/x86/x86int.asm" target="_blank">x86int.asm</a> and are following the scheme:</p>
<pre><code><span class="hljs-variable">%macro</span>    SAVE_REGS <span class="hljs-number">0</span>
    pushad 
    <span class="hljs-keyword">push</span> ds
    <span class="hljs-keyword">push</span> es
    <span class="hljs-keyword">push</span> fs
    <span class="hljs-keyword">push</span> gs 
    <span class="hljs-keyword">push</span> ebx
    mov bx,<span class="hljs-number">0x10</span>
    mov ds,bx
    <span class="hljs-keyword">pop</span> ebx
<span class="hljs-variable">%endmacro</span>

<span class="hljs-variable">%macro</span>    RESTORE_REGS <span class="hljs-number">0</span>
    <span class="hljs-keyword">pop</span> gs
    <span class="hljs-keyword">pop</span> fs
    <span class="hljs-keyword">pop</span> es
    <span class="hljs-keyword">pop</span> ds
    popad
<span class="hljs-variable">%endmacro</span>

<span class="hljs-variable">%macro</span>    INTERRUPT <span class="hljs-number">1</span>
global _asm_int<span class="hljs-number">_</span><span class="hljs-variable">%1</span>
_asm_int<span class="hljs-number">_</span><span class="hljs-variable">%1</span>:
    SAVE_REGS
    <span class="hljs-keyword">push</span> <span class="hljs-variable">%1</span>
    call isr_default_int
    <span class="hljs-keyword">pop</span> eax    ;;a enlever sinon
    mov al,<span class="hljs-number">0x20</span>
    out <span class="hljs-number">0x20</span>,al
    RESTORE_REGS
    iret
<span class="hljs-variable">%endmacro</span>
</code></pre><p>These macros will be used to define interrupt segment that will prevent corruption of the different registries, it will be very usefull for multitasking.</p>

                
                </section>
            
            </div>

            <div class="page-footer">
                
                    
                        
                        <a href="../Chapter-8/README.html" class="navigation-link next">Next</a>
                        
                    
                
            </div>
        </div>
    </div>
</div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="../gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="../gitbook/app.js"></script>
    </body>
</html>